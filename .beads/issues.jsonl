{"id":"hatchet-port-4dg","title":"Implement worker registration and task execution","description":"Worker functions in client.gleam:26-40 are stubbed:\n- new_worker() returns dummy ID\n- start_worker_blocking() does nothing\n- start_worker() returns empty closure\n\nRequired implementation:\n1. Register worker with dispatcher via gRPC\n2. Open persistent streaming channel for task polling\n3. Implement heartbeat (every 4 seconds)\n4. Execute task handlers with proper TaskContext\n5. Send completion/failure events back\n\nDepends on: gRPC implementation\n\nImpact: CRITICAL - cannot execute any workflows.","acceptance_criteria":"## Acceptance Criteria\n\n### Invariants\n- Worker MUST register with Hatchet dispatcher on start\n- Worker MUST poll for tasks via gRPC streaming\n- Worker MUST execute task handlers with proper TaskContext\n- Worker MUST send completion/failure events back\n- Worker MUST maintain heartbeat (every 4 seconds)\n- Worker MUST respect max_slots limit for concurrency\n\n### Variants\n- Start blocking (blocks until shutdown signal)\n- Start non-blocking (returns cleanup function)\n- Graceful shutdown (complete running tasks)\n- Forced shutdown (abandon tasks)\n\n### Happy Path\n1. Create worker with client, config, workflows\n2. Register workflows with Hatchet\n3. Start worker (blocking or non-blocking)\n4. Receive task from dispatcher stream\n5. Look up handler by action ID\n6. Create TaskContext with input/metadata\n7. Execute handler function\n8. Send completion event with output\n9. Continue polling for next task\n\n### Validation\n- Register worker with local Hatchet\n- Submit workflow, verify worker receives task\n- Execute handler, verify completion event sent\n- Test graceful shutdown\n- Test concurrent task limit\n\n### Implementation Reference  \nPython: /tmp/hatchet-python/hatchet_sdk/worker/worker.py\nGo: /tmp/hatchet/pkg/worker/worker.go\nSee: docs/HATCHET.md, docs/HATCHET_DESIGN_REVIEW.md\n\n### Files to Modify\n- src/hatchet/client.gleam - Replace stubs with real implementation\n- src/hatchet/types.gleam - Ensure Worker type is complete\n\n### Files to Create\n- src/hatchet/worker.gleam - Worker process/actor\n\n### Dependencies\n- Requires: hatchet-port-8uf (gRPC implementation)\n\n### Definition of Done\n- [ ] Worker registers with Hatchet dispatcher\n- [ ] Worker receives tasks via gRPC stream\n- [ ] Task handlers execute with proper context\n- [ ] Completion events sent back to dispatcher\n- [ ] Heartbeat mechanism works\n- [ ] Integration test: submit workflow, verify execution\n- [ ] All existing tests pass","status":"open","priority":1,"issue_type":"task","owner":"priorlewis43@gmail.com","created_at":"2026-01-26T13:20:59.77716988-06:00","created_by":"Lewis Prior","updated_at":"2026-01-26T13:29:19.897739972-06:00","dependencies":[{"issue_id":"hatchet-port-4dg","depends_on_id":"hatchet-port-8uf","type":"blocks","created_at":"2026-01-26T13:21:51.086671898-06:00","created_by":"Lewis Prior"}]}
{"id":"hatchet-port-5xe","title":"Implement durable tasks with checkpoint mechanism","description":"DurableTaskDef type exists but has no implementation:\n- Checkpoint key storage\n- State persistence across restarts\n- DurableContext with SleepFor() method\n\nPython/Go have full durable task support with:\n- Persistent sleep\n- State checkpointing\n- Resume after process restart\n\nImpact: MEDIUM - durable workflows not supported.","acceptance_criteria":"## Acceptance Criteria\n\n### Invariants\n- Durable tasks MUST survive process restarts\n- Checkpoint MUST persist state to Hatchet\n- SleepFor MUST be durable (continues after restart)\n- DurableContext MUST extend TaskContext\n\n### Variants\n- Durable task with single checkpoint\n- Durable task with multiple checkpoints\n- SleepFor with various durations\n- Resume from checkpoint after crash\n\n### Happy Path\n1. Create durable task with checkpoint_key\n2. Task executes, reaches SleepFor(duration)\n3. State checkpointed to Hatchet\n4. Process crashes/restarts\n5. Task resumes from checkpoint\n6. Continues execution after sleep\n\n### Validation\n- Unit test DurableTaskDef creation\n- Integration test checkpoint/restore cycle\n- Test SleepFor persistence\n\n### Implementation Reference\nPython: /tmp/hatchet-python/hatchet_sdk/v2/callable.py (durable decorator)\nGo: /tmp/hatchet/pkg/worker/context.go (DurableContext)\n\n### Files to Modify\n- src/hatchet/types.gleam - DurableTaskDef, DurableContext\n- src/hatchet/task.gleam - durable() helper\n\n### Files to Create\n- src/hatchet/durable.gleam - Durable task implementation\n\n### Definition of Done\n- [ ] DurableContext type with SleepFor method\n- [ ] Checkpoint mechanism implemented\n- [ ] State persistence to Hatchet backend\n- [ ] Resume from checkpoint works\n- [ ] Integration test: crash/resume cycle\n- [ ] All existing tests pass","status":"open","priority":2,"issue_type":"task","owner":"priorlewis43@gmail.com","created_at":"2026-01-26T13:21:01.664804943-06:00","created_by":"Lewis Prior","updated_at":"2026-01-26T13:29:38.53339115-06:00"}
{"id":"hatchet-port-7cr","title":"Add missing TaskContext methods","description":"TaskContext is missing methods that Python/Go SDKs provide:\n- spawn_workflow() - Execute child workflows\n- stream() - Send streaming events\n- refresh_timeout() - Extend execution timeout\n- release_slot() - Signal early completion\n- retry_count() - Get current retry attempt\n- step_run_errors() - Get all step failures\n\nImpact: MEDIUM - reduces SDK functionality.","acceptance_criteria":"## Acceptance Criteria\n\n### Invariants\n- spawn_workflow() MUST trigger child workflow via Hatchet API\n- stream() MUST send streaming events to Hatchet\n- refresh_timeout() MUST extend task execution timeout\n- release_slot() MUST signal early task completion\n- retry_count() MUST return current retry attempt number\n- step_run_errors() MUST return map of all step failures\n\n### Variants\n- spawn_workflow with/without options\n- spawn_workflows (batch)\n- stream text vs binary data\n\n### Happy Path\n1. Task handler receives TaskContext\n2. Call ctx.spawn_workflow(name, input)\n3. Receive WorkflowRunRef for child\n4. Optionally await child result\n5. Continue with task execution\n\n### Validation\n- Unit test each context method\n- Integration test spawn_workflow\n- Test streaming with local Hatchet dashboard\n\n### Implementation Reference\nPython: /tmp/hatchet-python/hatchet_sdk/context/context.py\nGo: /tmp/hatchet/pkg/worker/context.go\n\n### Files to Modify\n- src/hatchet/types.gleam - Add methods to TaskContext\n- src/hatchet/task.gleam - Implement context methods\n\n### Definition of Done\n- [ ] spawn_workflow() implemented and tested\n- [ ] spawn_workflows() batch version implemented\n- [ ] stream() sends events to Hatchet\n- [ ] refresh_timeout() extends timeout\n- [ ] release_slot() signals early completion\n- [ ] retry_count() returns attempt number\n- [ ] step_run_errors() returns failure map\n- [ ] All methods have unit tests\n- [ ] Integration test with real Hatchet","status":"open","priority":2,"issue_type":"task","owner":"priorlewis43@gmail.com","created_at":"2026-01-26T13:21:00.666467344-06:00","created_by":"Lewis Prior","updated_at":"2026-01-26T13:29:37.716636695-06:00"}
{"id":"hatchet-port-8uf","title":"Implement gRPC client for worker communication","description":"The Gleam SDK uses REST API only, but Hatchet requires gRPC for:\n- Worker registration (GetActionListener)\n- Task streaming (ListenV2)  \n- Completion reporting (SendStepActionEvent)\n- Workflow registration (PutWorkflow)\n\nResearch needed:\n- Gleam gRPC libraries\n- Erlang gRPC FFI options\n- Protocol buffer generation for Gleam\n\nImpact: CRITICAL - workers cannot function without gRPC.","acceptance_criteria":"## Acceptance Criteria\n\n### Invariants\n- gRPC client MUST connect to Hatchet engine on configured port\n- gRPC MUST use protobuf message format\n- Connection MUST support TLS (optional for local dev)\n- Client MUST authenticate with Bearer token\n\n### Variants\n- Connect with TLS enabled\n- Connect without TLS (insecure mode for local dev)\n- Connection timeout handling\n- Reconnection on disconnect\n\n### Happy Path\n1. Create gRPC client with host:port and token\n2. Connect to Hatchet engine\n3. Send GetActionListener request\n4. Receive streaming response\n5. Maintain heartbeat every 4 seconds\n\n### Validation\n- Test connection to localhost:7077 (local Hatchet)\n- Verify protobuf message encoding/decoding\n- Test heartbeat mechanism\n- Test reconnection logic\n\n### Research Required\n- Gleam gRPC libraries (gleam_grpc or Erlang FFI)\n- Protobuf code generation for Gleam\n- Look at /tmp/hatchet/api-contracts/ for proto definitions\n\n### Implementation Reference\nPython: /tmp/hatchet-python/hatchet_sdk/connection.py\nGo: /tmp/hatchet/pkg/client/v1/grpc-client.go\n\n### Files to Create\n- src/hatchet/internal/grpc.gleam - gRPC client\n- src/hatchet/internal/grpc_ffi.gleam - Erlang FFI for gRPC\n\n### Definition of Done\n- [ ] gRPC client connects to Hatchet\n- [ ] Protobuf messages encode/decode correctly\n- [ ] Heartbeat mechanism works\n- [ ] Integration test passes against local Hatchet\n- [ ] All existing tests still pass","status":"closed","priority":1,"issue_type":"task","owner":"priorlewis43@gmail.com","created_at":"2026-01-26T13:20:58.407830438-06:00","created_by":"Lewis Prior","updated_at":"2026-01-26T15:12:57.148783972-06:00","closed_at":"2026-01-26T15:12:57.148783972-06:00","close_reason":"Implemented gRPC client stub with TDD: 16 tests added, all 130 tests passing. Includes connect(), register_worker(), listen_v2(), send_step_event(), heartbeat(), and test helpers."}
{"id":"hatchet-port-9ou","title":"Add config file and environment variable loading","description":"Python/Go SDKs load config from:\n- client.yaml in working directory\n- Environment variables (HATCHET_CLIENT_TOKEN, etc)\n- JWT token parsing for server URL\n\nGleam SDK requires explicit host/token in code.\n\nImpact: LOW - improves developer experience.","acceptance_criteria":"## Acceptance Criteria\n\n### Invariants\n- Config MUST load from environment variables\n- Config MUST load from client.yaml if present\n- Environment variables MUST override file config\n- Token MUST be extractable from JWT for server URL\n\n### Variants\n- Load from HATCHET_CLIENT_TOKEN env var\n- Load from client.yaml file\n- Load from custom config path\n- Mixed: file + env override\n\n### Happy Path\n1. Set HATCHET_CLIENT_TOKEN env var\n2. Call hatchet.from_environment()\n3. Client created with token from env\n4. Host/port extracted from JWT payload\n\n### Environment Variables\n- HATCHET_CLIENT_TOKEN - JWT token (required)\n- HATCHET_CLIENT_HOST - Server host (optional)\n- HATCHET_CLIENT_PORT - Server port (optional)\n- HATCHET_CLIENT_TLS_STRATEGY - tls/mtls/none\n\n### Config File Format (client.yaml)\n\n\n### Validation\n- Test loading from env vars\n- Test loading from config file\n- Test env overrides file\n- Test JWT parsing for server URL\n\n### Implementation Reference\nPython: /tmp/hatchet-python/hatchet_sdk/loader.py (ConfigLoader)\nGo: Uses environment variables directly\n\n### Files to Create\n- src/hatchet/config.gleam - Config loading\n\n### Files to Modify\n- src/hatchet/client.gleam - from_environment()\n\n### Definition of Done\n- [ ] from_environment() function\n- [ ] Environment variable loading\n- [ ] Config file loading (optional)\n- [ ] JWT token parsing\n- [ ] Unit tests for config loading\n- [ ] All existing tests pass","status":"open","priority":2,"issue_type":"task","owner":"priorlewis43@gmail.com","created_at":"2026-01-26T13:21:12.011276424-06:00","created_by":"Lewis Prior","updated_at":"2026-01-26T13:29:56.199778411-06:00"}
{"id":"hatchet-port-csv","title":"Implement sleep_ms function using gleam_erlang","description":"The sleep_ms function in run.gleam:302-304 currently does nothing (returns Nil). This breaks the await_result polling mechanism.\n\nFix: Use gleam_erlang/process.sleep() for actual sleep functionality.\n\nImpact: CRITICAL - polling loops infinitely without this fix.","acceptance_criteria":"## Acceptance Criteria\n\n### Invariants\n- Sleep function MUST actually pause execution for the specified duration\n- Sleep MUST NOT consume CPU while waiting (use Erlang timer)\n- Sleep duration MUST be in milliseconds\n\n### Variants\n- Sleep with 0ms should return immediately\n- Sleep with negative value should return immediately (no error)\n- Sleep with very large value (\u003e 1 hour) should work correctly\n\n### Happy Path\n1. Call sleep_ms(500)\n2. Verify at least 500ms elapsed (within 50ms tolerance)\n3. Verify CPU was not spinning during sleep\n\n### Validation\n- Run gleam test - all existing tests pass\n- Create test sleep_ms_actually_sleeps_test to verify timing\n- Verify await_result() polling works with real delays\n\n### Implementation\nUse gleam_erlang process.sleep() - see docs/GLEAM_CONVENTIONS.md\n\n### Files\n- src/hatchet/run.gleam:302-304\n\n### Definition of Done\n- [ ] sleep_ms() uses process.sleep()\n- [ ] New test verifies actual sleeping  \n- [ ] await_result() polling works correctly\n- [ ] All 68+ tests pass","status":"closed","priority":1,"issue_type":"task","owner":"priorlewis43@gmail.com","created_at":"2026-01-26T13:20:40.436690798-06:00","created_by":"Lewis Prior","updated_at":"2026-01-26T15:06:03.704128688-06:00","closed_at":"2026-01-26T15:06:03.704128688-06:00","close_reason":"Already implemented - timer.sleep_ms correctly uses gleam/erlang/process.sleep"}
{"id":"hatchet-port-sit","title":"Add TLS/mTLS support for secure connections","description":"Python/Go SDKs support:\n- TLS encryption\n- mTLS (mutual TLS) authentication\n- Certificate configuration\n\nCurrent Gleam SDK uses plain HTTP only.\n\nImpact: LOW - required for production deployments.","acceptance_criteria":"## Acceptance Criteria\n\n### Invariants\n- TLS MUST encrypt all gRPC communication\n- mTLS MUST require client certificate\n- Certificates MUST be configurable via client options\n- Insecure mode MUST be explicitly enabled\n\n### Variants\n- TLS with server verification\n- mTLS with client certificate\n- Insecure mode (for local development)\n- Custom CA certificate\n\n### Happy Path (TLS)\n1. Create client with TLS config\n2. Load CA certificate\n3. Connect to Hatchet with TLS\n4. Verify encrypted communication\n\n### Happy Path (mTLS)\n1. Create client with mTLS config\n2. Load client cert and key\n3. Connect with mutual authentication\n4. Verify both sides authenticated\n\n### Validation\n- Test TLS connection to secure Hatchet\n- Test mTLS with client certificates\n- Test insecure mode works for local dev\n- Verify certificate validation errors\n\n### Implementation Reference\nPython: /tmp/hatchet-python/hatchet_sdk/loader.py (tls_config)\nGo: /tmp/hatchet/pkg/client/client.go (TLS options)\n\n### Files to Modify\n- src/hatchet/client.gleam - Add TLS options\n- src/hatchet/types.gleam - TLSConfig type\n\n### Definition of Done\n- [ ] TLSConfig type defined\n- [ ] with_tls() client option\n- [ ] with_mtls() client option  \n- [ ] with_insecure() for local dev\n- [ ] Certificate loading works\n- [ ] Integration test with TLS Hatchet","status":"open","priority":2,"issue_type":"task","owner":"priorlewis43@gmail.com","created_at":"2026-01-26T13:21:11.080596219-06:00","created_by":"Lewis Prior","updated_at":"2026-01-26T13:29:55.302127583-06:00"}

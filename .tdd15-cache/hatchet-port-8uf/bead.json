[
  {
    "id": "hatchet-port-8uf",
    "title": "Implement gRPC client for worker communication",
    "description": "The Gleam SDK uses REST API only, but Hatchet requires gRPC for:\n- Worker registration (GetActionListener)\n- Task streaming (ListenV2)  \n- Completion reporting (SendStepActionEvent)\n- Workflow registration (PutWorkflow)\n\nResearch needed:\n- Gleam gRPC libraries\n- Erlang gRPC FFI options\n- Protocol buffer generation for Gleam\n\nImpact: CRITICAL - workers cannot function without gRPC.",
    "acceptance_criteria": "## Acceptance Criteria\n\n### Invariants\n- gRPC client MUST connect to Hatchet engine on configured port\n- gRPC MUST use protobuf message format\n- Connection MUST support TLS (optional for local dev)\n- Client MUST authenticate with Bearer token\n\n### Variants\n- Connect with TLS enabled\n- Connect without TLS (insecure mode for local dev)\n- Connection timeout handling\n- Reconnection on disconnect\n\n### Happy Path\n1. Create gRPC client with host:port and token\n2. Connect to Hatchet engine\n3. Send GetActionListener request\n4. Receive streaming response\n5. Maintain heartbeat every 4 seconds\n\n### Validation\n- Test connection to localhost:7077 (local Hatchet)\n- Verify protobuf message encoding/decoding\n- Test heartbeat mechanism\n- Test reconnection logic\n\n### Research Required\n- Gleam gRPC libraries (gleam_grpc or Erlang FFI)\n- Protobuf code generation for Gleam\n- Look at /tmp/hatchet/api-contracts/ for proto definitions\n\n### Implementation Reference\nPython: /tmp/hatchet-python/hatchet_sdk/connection.py\nGo: /tmp/hatchet/pkg/client/v1/grpc-client.go\n\n### Files to Create\n- src/hatchet/internal/grpc.gleam - gRPC client\n- src/hatchet/internal/grpc_ffi.gleam - Erlang FFI for gRPC\n\n### Definition of Done\n- [ ] gRPC client connects to Hatchet\n- [ ] Protobuf messages encode/decode correctly\n- [ ] Heartbeat mechanism works\n- [ ] Integration test passes against local Hatchet\n- [ ] All existing tests still pass",
    "status": "open",
    "priority": 1,
    "issue_type": "task",
    "owner": "priorlewis43@gmail.com",
    "created_at": "2026-01-26T13:20:58.407830438-06:00",
    "created_by": "Lewis Prior",
    "updated_at": "2026-01-26T13:29:06.412980379-06:00",
    "dependents": [
      {
        "id": "hatchet-port-4dg",
        "title": "Implement worker registration and task execution",
        "description": "Worker functions in client.gleam:26-40 are stubbed:\n- new_worker() returns dummy ID\n- start_worker_blocking() does nothing\n- start_worker() returns empty closure\n\nRequired implementation:\n1. Register worker with dispatcher via gRPC\n2. Open persistent streaming channel for task polling\n3. Implement heartbeat (every 4 seconds)\n4. Execute task handlers with proper TaskContext\n5. Send completion/failure events back\n\nDepends on: gRPC implementation\n\nImpact: CRITICAL - cannot execute any workflows.",
        "acceptance_criteria": "## Acceptance Criteria\n\n### Invariants\n- Worker MUST register with Hatchet dispatcher on start\n- Worker MUST poll for tasks via gRPC streaming\n- Worker MUST execute task handlers with proper TaskContext\n- Worker MUST send completion/failure events back\n- Worker MUST maintain heartbeat (every 4 seconds)\n- Worker MUST respect max_slots limit for concurrency\n\n### Variants\n- Start blocking (blocks until shutdown signal)\n- Start non-blocking (returns cleanup function)\n- Graceful shutdown (complete running tasks)\n- Forced shutdown (abandon tasks)\n\n### Happy Path\n1. Create worker with client, config, workflows\n2. Register workflows with Hatchet\n3. Start worker (blocking or non-blocking)\n4. Receive task from dispatcher stream\n5. Look up handler by action ID\n6. Create TaskContext with input/metadata\n7. Execute handler function\n8. Send completion event with output\n9. Continue polling for next task\n\n### Validation\n- Register worker with local Hatchet\n- Submit workflow, verify worker receives task\n- Execute handler, verify completion event sent\n- Test graceful shutdown\n- Test concurrent task limit\n\n### Implementation Reference  \nPython: /tmp/hatchet-python/hatchet_sdk/worker/worker.py\nGo: /tmp/hatchet/pkg/worker/worker.go\nSee: docs/HATCHET.md, docs/HATCHET_DESIGN_REVIEW.md\n\n### Files to Modify\n- src/hatchet/client.gleam - Replace stubs with real implementation\n- src/hatchet/types.gleam - Ensure Worker type is complete\n\n### Files to Create\n- src/hatchet/worker.gleam - Worker process/actor\n\n### Dependencies\n- Requires: hatchet-port-8uf (gRPC implementation)\n\n### Definition of Done\n- [ ] Worker registers with Hatchet dispatcher\n- [ ] Worker receives tasks via gRPC stream\n- [ ] Task handlers execute with proper context\n- [ ] Completion events sent back to dispatcher\n- [ ] Heartbeat mechanism works\n- [ ] Integration test: submit workflow, verify execution\n- [ ] All existing tests pass",
        "status": "open",
        "priority": 1,
        "issue_type": "task",
        "owner": "priorlewis43@gmail.com",
        "created_at": "2026-01-26T13:20:59.77716988-06:00",
        "created_by": "Lewis Prior",
        "updated_at": "2026-01-26T13:29:19.897739972-06:00",
        "dependency_type": "blocks"
      }
    ]
  }
]
